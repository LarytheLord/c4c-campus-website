import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.GIa-TyKg.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./index.CMF_dOlt.js";function q({quizId:c,lessonId:N,onStart:z}){const[t,h]=r.useState(null),[i,p]=r.useState([]),[f,d]=r.useState(!0),[m,u]=r.useState(null);r.useEffect(()=>{j()},[c]);async function j(){try{d(!0);const{data:{session:s}}=await window.supabase.auth.getSession();if(!s){u("Please login to view quiz");return}const a=await fetch(`/api/quizzes/${c}`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!a.ok)throw new Error("Failed to load quiz");const o=await a.json();h(o.quiz),p(o.attempts||[])}catch(s){u(s instanceof Error?s.message:"Failed to load quiz")}finally{d(!1)}}async function x(){if(t)try{const{data:{session:s}}=await window.supabase.auth.getSession();if(!s){alert("Please login to take quiz");return}const a=await fetch(`/api/quizzes/${t.id}/start`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(!a.ok){const g=await a.json();alert(g.error||"Failed to start quiz");return}const o=await a.json();window.location.href=`/quizzes/${t.id}/take?attemptId=${o.attempt.id}`}catch(s){alert("Failed to start quiz. Please try again."),console.error(s)}}if(f)return e.jsxs("div",{className:"card animate-pulse",children:[e.jsx("div",{className:"h-8 bg-surface-hover rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-surface-hover rounded w-full mb-2"}),e.jsx("div",{className:"h-4 bg-surface-hover rounded w-5/6"})]});if(m||!t)return e.jsx("div",{className:"card border-error",children:e.jsx("p",{className:"text-error",children:m||"Quiz not found"})});const n=i.length>0?i.reduce((s,a)=>a.score>s.score?a:s):null,v=t.max_attempts===0||i.length<t.max_attempts,b=i.some(s=>!s.submitted_at),l=new Date,w=t.is_published&&(!t.available_from||new Date(t.available_from)<=l)&&(!t.available_until||new Date(t.available_until)>=l);return e.jsx("div",{className:"card bg-primary/5 border-primary",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:t.title}),t.description&&e.jsx("p",{className:"text-text-muted mb-4",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm mb-4",children:[t.time_limit&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:[t.time_limit," minutes"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:["Passing: ",t.passing_score,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:t.max_attempts===0?"Unlimited attempts":`${t.max_attempts} attempt${t.max_attempts>1?"s":""}`})]})]}),n&&e.jsxs("div",{className:"mb-4 p-3 bg-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Your Best Score:"}),e.jsxs("span",{className:`font-bold ${n.passed?"text-success":"text-error"}`,children:[n.score,"%"]})]}),n.passed&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-success text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Passed!"})]})]}),i.length>0&&e.jsxs("div",{className:"mb-4 text-sm text-text-muted",children:[i.length," of ",t.max_attempts===0?"âˆž":t.max_attempts," attempts used"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:w?e.jsxs(e.Fragment,{children:[b?e.jsx("button",{onClick:x,className:"btn btn-primary",children:"Continue Quiz"}):v?e.jsx("button",{onClick:x,className:"btn btn-primary",children:i.length===0?"Start Quiz":"Retake Quiz"}):e.jsx("div",{className:"text-text-muted",children:"Maximum attempts reached"}),i.length>0&&e.jsx("a",{href:`/quizzes/${t.id}/attempts`,className:"btn btn-ghost",children:"View All Attempts"})]}):e.jsxs("div",{className:"text-text-muted",children:[!t.is_published&&"Quiz not published yet",t.available_from&&new Date(t.available_from)>l&&`Available from ${new Date(t.available_from).toLocaleDateString()}`,t.available_until&&new Date(t.available_until)<l&&"Quiz deadline has passed"]})})]})]})})}export{q as QuizCard};
