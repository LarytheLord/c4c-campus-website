import{c as M}from"../assets/index.CS-uK3Uq.js";import{j as e}from"../assets/jsx-runtime.D_zvdyIk.js";import{r as u}from"../assets/index.GIa-TyKg.js";import{C as R,B as P,L as H,a as V,b as F,P as J,c as z,d as q,p as X,e as Y,f as Z,i as G}from"../assets/chart._lwrjFc3.js";import{a as j}from"../assets/client.alY4YNBQ.js";import"../assets/_commonjsHelpers.D6-XlEtG.js";import"../assets/index.CMF_dOlt.js";import"../assets/index.Bkf-Ke-4.js";function K(t,n,o){if(!t||t.length===0)throw new Error("No data to export");const r=Object.keys(t[0]),c=[r.join(","),...t.map(a=>r.map(d=>{const x=a[d];if(x==null)return"";let l=typeof x=="object"?JSON.stringify(x):String(x);return(l.includes(",")||l.includes(`
`)||l.includes('"'))&&(l=`"${l.replace(/"/g,'""')}"`),l}).join(","))].join(`
`),h=new Blob([c],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(h),s=document.createElement("a");s.setAttribute("href",m),s.setAttribute("download",`${n}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(m)}function Q({analytics:t,loading:n=!1}){if(n)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[...Array(8)].map((r,i)=>e.jsx("div",{className:"card animate-pulse",children:e.jsx("div",{className:"h-16 bg-gray-200 rounded"})},i))});if(!t)return e.jsx("div",{className:"card mb-8",children:e.jsx("p",{className:"text-center text-text-muted",children:"No analytics data available"})});const o=[{label:"Total Students",value:t.total_students,icon:"ðŸ‘¥",color:"bg-blue-500/10",textColor:"text-blue-600"},{label:"Active Students",value:t.active_students,icon:"âœ…",color:"bg-green-500/10",textColor:"text-green-600"},{label:"Completed",value:t.completed_students,icon:"ðŸŽ“",color:"bg-purple-500/10",textColor:"text-purple-600"},{label:"Dropped",value:t.dropped_students,icon:"âš ï¸",color:"bg-orange-500/10",textColor:"text-orange-600"},{label:"Avg. Completion",value:`${t.average_completion_percentage}%`,icon:"ðŸ“Š",color:"bg-indigo-500/10",textColor:"text-indigo-600"},{label:"Avg. Time Spent",value:`${t.average_time_spent_hours}h`,icon:"â±ï¸",color:"bg-cyan-500/10",textColor:"text-cyan-600"},{label:"Engagement Rate",value:`${t.engagement_rate}%`,icon:"ðŸ”¥",color:"bg-pink-500/10",textColor:"text-pink-600",subtitle:"Active in last 7 days"},{label:"Struggling Students",value:t.struggling_students_count,icon:"ðŸ†˜",color:"bg-red-500/10",textColor:"text-red-600",subtitle:"Need attention"}];return e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:t.cohort_name}),e.jsx("p",{className:"text-text-muted",children:t.course_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${t.status==="active"?"bg-green-500/10 text-green-600":t.status==="upcoming"?"bg-blue-500/10 text-blue-600":t.status==="completed"?"bg-gray-500/10 text-gray-600":"bg-orange-500/10 text-orange-600"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),e.jsxs("p",{className:"text-sm text-text-muted mt-2",children:[new Date(t.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t.end_date&&` - ${new Date(t.end_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.map((r,i)=>e.jsx("div",{className:"card hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 ${r.color} rounded-lg flex-shrink-0`,children:e.jsx("span",{className:"text-2xl",children:r.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-text-muted truncate",children:r.label}),e.jsx("p",{className:`text-2xl font-bold ${r.textColor}`,children:r.value}),r.subtitle&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:r.subtitle})]})]})},i))}),e.jsx("div",{className:"card bg-gradient-to-r from-primary/5 to-primary/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Total Lessons in Course"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:t.total_lessons})]}),t.average_completion_percentage>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Overall Progress"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${t.average_completion_percentage}%`}})}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:[t.average_completion_percentage,"%"]})]})]})]})})]})}const A="label";function $(t,n){typeof t=="function"?t(n):t&&(t.current=n)}function W(t,n){const o=t.options;o&&n&&Object.assign(o,n)}function T(t,n){t.labels=n}function D(t,n,o=A){const r=[];t.datasets=n.map(i=>{const c=t.datasets.find(h=>h[o]===i[o]);return!c||!i.data||r.includes(c)?{...i}:(r.push(c),Object.assign(c,i),c)})}function ee(t,n=A){const o={labels:[],datasets:[]};return T(o,t.labels),D(o,t.datasets,n),o}function te(t,n){const{height:o=150,width:r=300,redraw:i=!1,datasetIdKey:c,type:h,data:m,options:s,plugins:a=[],fallbackContent:d,updateMode:x,...l}=t,p=u.useRef(null),g=u.useRef(null),I=()=>{p.current&&(g.current=new R(p.current,{type:h,data:ee(m,c),options:s&&{...s},plugins:a}),$(n,g.current))},k=()=>{$(n,null),g.current&&(g.current.destroy(),g.current=null)};return u.useEffect(()=>{!i&&g.current&&s&&W(g.current,s)},[i,s]),u.useEffect(()=>{!i&&g.current&&T(g.current.config.data,m.labels)},[i,m.labels]),u.useEffect(()=>{!i&&g.current&&m.datasets&&D(g.current.config.data,m.datasets,c)},[i,m.datasets]),u.useEffect(()=>{g.current&&(i?(k(),setTimeout(I)):g.current.update(x))},[i,s,m.labels,m.datasets,x]),u.useEffect(()=>{g.current&&(k(),setTimeout(I))},[h]),u.useEffect(()=>(I(),()=>k()),[]),e.jsx("canvas",{ref:p,role:"img",height:o,width:r,...l,children:d})}const se=u.forwardRef(te);function U(t,n){return R.register(n),u.forwardRef((o,r)=>e.jsx(se,{...o,ref:r,type:t}))}const B=U("line",H),ne=U("bar",P);R.register(V,F,J,z,q,X,Y,Z,G);function ae({progressData:t,loading:n=!1,chartType:o="line"}){if(n)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})});if(!t||t.length===0)return e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Progress Over Time"}),e.jsx("p",{className:"text-center text-text-muted py-8",children:"No progress data available yet"})]});const r=t.map(l=>new Date(l.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),i={labels:r,datasets:[{label:"Completed Lessons",data:t.map(l=>l.completed_lessons),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0},{label:"Active Students",data:t.map(l=>l.active_students),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",tension:.4,fill:!0},{label:"New Enrollments",data:t.map(l=>l.new_enrollments),borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",tension:.4,fill:!0}]},c={labels:r,datasets:[{label:"Avg. Completion Rate (%)",data:t.map(l=>l.average_completion_rate),borderColor:"rgb(236, 72, 153)",backgroundColor:"rgba(236, 72, 153, 0.1)",tension:.4,fill:!0}]},h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14},bodyFont:{size:13}}},scales:{y:{beginAtZero:!0,ticks:{precision:0},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},m={...h,scales:{...h.scales,y:{...h.scales.y,max:100,ticks:{callback:l=>`${l}%`}}}},s=t.reduce((l,p)=>l+p.completed_lessons,0),a=t.reduce((l,p)=>l+p.new_enrollments,0),d=t.length>0?Math.round(t.reduce((l,p)=>l+p.average_completion_rate,0)/t.length):0,x=o==="line"?B:ne;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"card bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-muted",children:"Total Completions (30d)"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s})]}),e.jsx("span",{className:"text-4xl",children:"ðŸ“š"})]})}),e.jsx("div",{className:"card bg-purple-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-muted",children:"New Enrollments (30d)"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:a})]}),e.jsx("span",{className:"text-4xl",children:"ðŸ‘‹"})]})}),e.jsx("div",{className:"card bg-pink-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-muted",children:"Avg. Completion Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-pink-600",children:[d,"%"]})]}),e.jsx("span",{className:"text-4xl",children:"ðŸ“ˆ"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Activity Trends (Last 30 Days)"}),e.jsx("p",{className:"text-sm text-text-muted",children:"Track student activity and lesson completions over time"})]}),e.jsx("div",{style:{height:"350px"},children:e.jsx(x,{data:i,options:h})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Completion Rate Trend"}),e.jsx("p",{className:"text-sm text-text-muted",children:"Average daily completion rate across all students"})]}),e.jsx("div",{style:{height:"250px"},children:e.jsx(B,{data:c,options:m})})]})]})}function re({students:t,loading:n=!1}){const[o,r]=u.useState("completion");if(n)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,a)=>e.jsx("div",{className:"h-20 bg-gray-200 rounded"},a))})]})});if(!t||t.length===0)return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-bold",children:"All Students on Track!"})]}),e.jsx("p",{className:"text-text-muted",children:"Great news! All students are making good progress."})]});const i=[...t].sort((s,a)=>o==="completion"?s.completion_percentage-a.completion_percentage:a.days_since_activity-s.days_since_activity),c=s=>s.status==="dropped"?{text:"Dropped",color:"bg-red-500 text-white"}:s.days_since_activity>14?{text:"Very Inactive",color:"bg-red-500/10 text-red-600"}:s.days_since_activity>7?{text:"Inactive",color:"bg-orange-500/10 text-orange-600"}:s.completion_percentage<10?{text:"Low Progress",color:"bg-yellow-500/10 text-yellow-600"}:{text:"At Risk",color:"bg-orange-500/10 text-orange-600"},h=s=>s<10?"bg-red-500":s<20?"bg-orange-500":"bg-yellow-500",m=(s,a)=>{const d=encodeURIComponent("Checking in on your course progress"),x=encodeURIComponent(`Hi ${a},

I noticed you haven't been active in the course recently. Is everything okay? Let me know if there's anything I can do to help you get back on track.

Best regards`);window.open(`mailto:${s}?subject=${d}&body=${x}`,"_blank")};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ†˜"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Students Needing Attention"}),e.jsxs("p",{className:"text-sm text-text-muted",children:[t.length," student",t.length!==1?"s":""," require support"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("completion"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${o==="completion"?"bg-primary text-white":"bg-gray-100 text-text-muted hover:bg-gray-200"}`,children:"By Progress"}),e.jsx("button",{onClick:()=>r("activity"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${o==="activity"?"bg-primary text-white":"bg-gray-100 text-text-muted hover:bg-gray-200"}`,children:"By Activity"})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-red-600 text-xl flex-shrink-0",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800",children:"Action Required"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"These students have either low completion rates or haven't been active recently. Consider reaching out to offer support."})]})]})}),e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:i.map(s=>{const a=c(s);return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-base truncate",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a.color}`,children:a.text})]}),e.jsx("p",{className:"text-sm text-text-muted mb-3 truncate",children:s.email}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-text-muted",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.completion_percentage,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${h(s.completion_percentage)} transition-all duration-500`,style:{width:`${s.completion_percentage}%`}})}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[s.completed_lessons," of ",s.total_lessons," lessons completed"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Last active:"}),e.jsx("span",{className:"ml-1 font-medium",children:s.days_since_activity===0?"Today":s.days_since_activity===1?"Yesterday":`${s.days_since_activity} days ago`})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Time spent:"}),e.jsxs("span",{className:"ml-1 font-medium",children:[s.time_spent_hours,"h"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>m(s.email,s.name),className:"btn btn-sm btn-primary whitespace-nowrap",title:"Send email",children:"ðŸ“§ Email"}),e.jsx("a",{href:`/teacher/students/${s.user_id}`,className:"btn btn-sm btn-ghost text-center whitespace-nowrap",title:"View details",children:"ðŸ‘ï¸ View"})]})]})},s.user_id)})}),t.length>1&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{const s=t.map(d=>d.email).join(","),a=encodeURIComponent("Checking in on your course progress");window.open(`mailto:${s}?subject=${a}`,"_blank")},className:"btn btn-secondary w-full",children:"ðŸ“§ Email All Students"})})]})}function le({entries:t,loading:n=!1}){const[o,r]=u.useState(!1);if(n)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((a,d)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},d))})]})});if(!t||t.length===0)return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ†"}),e.jsx("h3",{className:"text-lg font-bold",children:"Top Performers"})]}),e.jsx("p",{className:"text-center text-text-muted py-8",children:"No student progress yet. Check back once students start completing lessons!"})]});const i=o?t:t.slice(0,5),c=a=>{switch(a){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${a}`}},h=a=>{switch(a){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500";case 3:return"bg-gradient-to-r from-orange-400 to-orange-600";default:return"bg-gradient-to-r from-blue-400 to-blue-600"}},m=a=>a>=80?"text-green-600":a>=60?"text-blue-600":a>=40?"text-yellow-600":"text-orange-600",s=a=>{const d=new Date(a),l=Math.floor((new Date().getTime()-d.getTime())/(1e3*60*60*24));return l===0?"Today":l===1?"Yesterday":l<7?`${l} days ago`:d.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ†"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Top Performers"}),e.jsx("p",{className:"text-sm text-text-muted",children:"Students leading the way"})]})]}),t.length>5&&e.jsx("button",{onClick:()=>r(!o),className:"text-sm text-primary hover:underline",children:o?"Show Less":`Show All (${t.length})`})]}),e.jsx("div",{className:"space-y-3",children:i.map((a,d)=>{const x=a.rank<=3,l=c(a.rank),p=h(a.rank);return e.jsxs("div",{className:`
                rounded-lg p-4 transition-all
                ${x?"bg-gradient-to-r from-gray-50 to-white border-2 border-gray-200 shadow-md hover:shadow-lg":"bg-white border border-gray-200 hover:border-gray-300 hover:shadow-md"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:x?e.jsx("div",{className:`
                      w-12 h-12 rounded-full flex items-center justify-center
                      text-2xl shadow-lg
                      ${p}
                    `,children:l}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-gray-600",children:l})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-base truncate mb-1",children:a.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted block text-xs",children:"Completion"}),e.jsxs("span",{className:`font-bold ${m(a.completion_percentage)}`,children:[a.completion_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted block text-xs",children:"Lessons"}),e.jsx("span",{className:"font-bold text-blue-600",children:a.completed_lessons})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted block text-xs",children:"Time"}),e.jsxs("span",{className:"font-bold text-purple-600",children:[a.time_spent_hours,"h"]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("span",{className:"text-xs text-text-muted block",children:"Last active"}),e.jsx("span",{className:"text-sm font-medium",children:s(a.last_activity_at)})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${x?p:"bg-blue-500"}`,style:{width:`${a.completion_percentage}%`}})})})]},a.user_id)})}),t.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(t.reduce((a,d)=>a+d.completion_percentage,0)/t.length),"%"]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Avg. Completion"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Math.round(t.reduce((a,d)=>a+d.completed_lessons,0)/t.length)}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Avg. Lessons"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[(t.reduce((a,d)=>a+d.time_spent_hours,0)/t.length).toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Avg. Time"})]})]})}),t.length>0&&t[0].completion_percentage===100&&e.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸŽ‰"}),e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:t[0].name})," has completed the entire course! Congratulations!"]})]})})]})}const oe="https://auyysgeurtnpidppebqj.supabase.co",ie="***REMOVED***",b=M(oe,ie);let O=null,_=[],f=null,E=null,L=null,v=null,N=null,y=null,w=null;async function ce(){const{data:{user:t}}=await b.auth.getUser();if(!t){window.location.href="/login";return}O=t;const{data:n}=await b.from("applications").select("name, role").eq("user_id",t.id).single();if(!n?.role||n.role!=="teacher"&&n.role!=="admin"){document.getElementById("loading-state")?.classList.add("hidden"),document.getElementById("access-denied")?.classList.remove("hidden");return}await de(),document.getElementById("loading-state")?.classList.add("hidden"),document.getElementById("main-content")?.classList.remove("hidden"),me(),xe()}async function de(){const{data:t}=await b.from("courses").select("id").eq("created_by",O.id);if(!t||t.length===0){const c=document.getElementById("cohort-selector");c.innerHTML='<option value="">No courses found</option>';return}const n=t.map(c=>c.id),{data:o,error:r}=await b.from("cohorts").select("*, courses(name)").in("course_id",n).order("created_at",{ascending:!1});if(r){console.error("Error loading cohorts:",r);return}_=o||[];const i=document.getElementById("cohort-selector");_.length===0?(i.innerHTML='<option value="">No cohorts found</option>',document.getElementById("no-cohort")?.classList.remove("hidden")):i.innerHTML='<option value="">Select a cohort...</option>'+_.map(c=>`<option value="${c.id}">${c.name} - ${c.courses?.title||"Unknown Course"}</option>`).join("")}async function S(t){try{C(null,!0);const n=await fetch(`/api/teacher/cohort-analytics?cohortId=${t}`);if(!n.ok)throw new Error("Failed to fetch analytics data");E=await n.json(),ue(),document.getElementById("export-btn")?.classList.remove("hidden"),document.getElementById("no-cohort")?.classList.add("hidden"),document.getElementById("no-data")?.classList.add("hidden"),C(E,!1)}catch(n){console.error("Error loading dashboard data:",n),document.getElementById("no-data")?.classList.remove("hidden"),C(null,!1)}}function C(t,n){const o=document.getElementById("cohort-stats-container");o&&!v&&(v=j.createRoot(o)),v&&v.render(u.createElement(Q,{analytics:t?.analytics||null,loading:n}));const r=document.getElementById("progress-chart-container");r&&!N&&(N=j.createRoot(r)),N&&N.render(u.createElement(ae,{progressData:t?.progress_over_time||[],loading:n}));const i=document.getElementById("struggling-students-container");i&&!y&&(y=j.createRoot(i)),y&&y.render(u.createElement(re,{students:t?.struggling_students||[],loading:n}));const c=document.getElementById("leaderboard-container");c&&!w&&(w=j.createRoot(c)),w&&w.render(u.createElement(le,{entries:t?.leaderboard||[],loading:n}))}function me(){document.getElementById("cohort-selector")?.addEventListener("change",t=>{const n=parseInt(t.target.value);n?(f=n,S(n)):(f=null,document.getElementById("no-cohort")?.classList.remove("hidden"),document.getElementById("export-btn")?.classList.add("hidden"),C(null,!1))}),document.getElementById("refresh-btn")?.addEventListener("click",async()=>{if(f){const t=document.getElementById("refresh-icon");t&&t.classList.add("animate-spin"),await S(f),setTimeout(()=>{t?.classList.remove("animate-spin")},500)}}),document.getElementById("export-btn")?.addEventListener("click",()=>{if(E?.students){const t=E.students.map(r=>({student_name:r.name,email:r.email,enrolled_date:new Date(r.enrolled_at).toLocaleDateString(),status:r.status,completed_lessons:r.completed_lessons,total_lessons:r.total_lessons,completion_percentage:r.completion_percentage,time_spent_hours:r.time_spent_hours,last_activity_date:new Date(r.last_activity_at).toLocaleDateString(),days_since_activity:r.days_since_activity})),o=`${(_.find(r=>r.id===f)?.name||"cohort").toLowerCase().replace(/\s+/g,"-")}-progress-${new Date().toISOString().split("T")[0]}`;K(t,o)}}),document.getElementById("logout-btn")?.addEventListener("click",async()=>{await b.auth.signOut(),window.location.href="/login"})}function xe(){L=window.setInterval(()=>{f&&(console.log("Auto-refreshing dashboard data..."),S(f))},3e5)}function ue(){const t=document.getElementById("last-updated");t&&(t.textContent=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))}window.addEventListener("beforeunload",()=>{L&&clearInterval(L)});ce();
