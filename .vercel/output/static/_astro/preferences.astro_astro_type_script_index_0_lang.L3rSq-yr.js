import{b as o,a as n}from"../assets/notifications.BUGlD4Nh.js";const i=document.getElementById("preferences-form"),c=i.querySelector('[name="digest_mode"]'),g=document.getElementById("digest-time-container"),l=document.getElementById("quiet-hours-enabled"),u=document.getElementById("quiet-hours-settings"),d=document.getElementById("test-notification-btn");c?.addEventListener("change",()=>{const t=c.value;t==="daily"||t==="weekly"?g?.classList.remove("hidden"):g?.classList.add("hidden")});c?.dispatchEvent(new Event("change"));l?.addEventListener("change",()=>{l.checked?u?.classList.remove("hidden"):u?.classList.add("hidden")});l?.checked&&u?.classList.remove("hidden");i?.addEventListener("submit",async t=>{t.preventDefault();const f=i.querySelector('button[type="submit"]');o(f,!0);try{const e=new FormData(i),s={};e.forEach((a,h)=>{if(h.startsWith("event_")){const[,r,p]=h.split("_");s[r]||(s[r]={}),s[r][p]=a==="on"}});const _={inapp_enabled:e.get("inapp_enabled")==="on",email_enabled:e.get("email_enabled")==="on",push_enabled:e.get("push_enabled")==="on",digest_mode:e.get("digest_mode"),digest_time:e.get("digest_time"),quiet_hours_enabled:e.get("quiet_hours_enabled")==="on",quiet_hours_start:e.get("quiet_hours_start"),quiet_hours_end:e.get("quiet_hours_end"),event_preferences:s},m=await fetch("/api/notifications/preferences",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(m.ok)n("Preferences saved successfully!","success");else{const a=await m.json();n(a.error||"Failed to save preferences","error")}}catch(e){n(e.message||"Failed to save preferences","error")}finally{o(f,!1)}});d?.addEventListener("click",async()=>{o(d,!0,"Sending...");try{(await fetch("/api/notifications/test",{method:"POST"})).ok?n("Test notification sent! Check your notification bell.","success"):n("Failed to send test notification","error")}catch{n("Failed to send test notification","error")}finally{o(d,!1)}});
