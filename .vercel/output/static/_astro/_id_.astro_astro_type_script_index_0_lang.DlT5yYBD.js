import{c as R}from"../assets/index.CS-uK3Uq.js";import{a as I}from"../assets/client.alY4YNBQ.js";import{r as u}from"../assets/index.GIa-TyKg.js";import{j as e}from"../assets/jsx-runtime.D_zvdyIk.js";import{g as T,f as U,v as A}from"../assets/file-upload.F6qW9e-X.js";import"../assets/supabase.DdTcER9f.js";import"../assets/_commonjsHelpers.D6-XlEtG.js";import"../assets/index.CMF_dOlt.js";import"../assets/index.Bkf-Ke-4.js";function P({rubric:t,maxPoints:i}){if(!t||!t.criteria||t.criteria.length===0)return e.jsx("div",{className:"bg-gray-50 rounded-lg p-6 text-center text-gray-500",children:e.jsx("p",{children:"No grading rubric available for this assignment."})});const o=t.criteria.reduce((n,c)=>n+c.points,0);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Grading Rubric"}),e.jsxs("p",{className:"text-sm text-blue-100 mt-1",children:["Total: ",o," points"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:t.criteria.map((n,c)=>e.jsxs("div",{className:"p-5 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:n.points}),e.jsx("span",{className:"text-sm text-gray-600",children:"pts"})]})]}),n.description&&e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:n.description}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${n.points/i*100}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(n.points/i*100).toFixed(1),"% of total grade"]})]})]},c))}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Points"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:o})]})})]})}function z({dueDate:t,lateAllowed:i=!1}){const[o,n]=u.useState(""),[c,r]=u.useState(!1),[a,m]=u.useState("safe");u.useEffect(()=>{const h=()=>{const S=new Date().getTime(),g=new Date(t).getTime()-S;if(g<=0){r(!0),m("overdue");const $=Math.abs(g),D=Math.floor($/(1e3*60*60*24)),d=Math.floor($%(1e3*60*60*24)/(1e3*60*60));D>0?n(`${D} day${D>1?"s":""} overdue`):n(`${d} hour${d>1?"s":""} overdue`);return}r(!1);const N=Math.floor(g/(1e3*60*60*24)),v=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),j=Math.floor(g%(1e3*60*60)/(1e3*60)),w=Math.floor(g%(1e3*60)/1e3),_=N*24+v;_<6?m("urgent"):_<24?m("warning"):m("safe"),N>0?n(`${N}d ${v}h ${j}m`):v>0?n(`${v}h ${j}m ${w}s`):j>0?n(`${j}m ${w}s`):n(`${w}s`)};h();const y=setInterval(h,1e3);return()=>clearInterval(y)},[t]);const l=()=>{switch(a){case"safe":return"bg-green-50 border-green-200 text-green-700";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-700";case"urgent":return"bg-red-50 border-red-200 text-red-700 animate-pulse";case"overdue":return i?"bg-orange-50 border-orange-200 text-orange-700":"bg-gray-50 border-gray-300 text-gray-600";default:return"bg-gray-50 border-gray-200 text-gray-700"}},x=()=>{switch(a){case"safe":return"‚úì";case"warning":return"‚ö†Ô∏è";case"urgent":return"üö®";case"overdue":return i?"‚è∞":"üîí";default:return"‚è∞"}},f=()=>c?i?"Late submission allowed":"Submissions closed":a==="urgent"?"Due very soon!":a==="warning"?"Due soon":"Time remaining";return e.jsxs("div",{className:`rounded-lg border-2 p-6 ${l()}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:x()}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide",children:f()})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2 font-mono",children:o}),e.jsxs("div",{className:"text-sm opacity-75",children:["Due: ",new Date(t).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})]})]}),c&&i&&e.jsx("div",{className:"mt-4 text-sm text-center",children:"Note: Late submissions may incur a penalty"})]})}function G({submission:t,maxPoints:i,isPastDue:o=!1,lateAllowed:n=!1}){if(!t)return o&&!n?e.jsxs("div",{className:"bg-gray-100 border-2 border-gray-300 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:"üîí"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700",children:"Not Submitted"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Submissions are closed"})]})]}),e.jsx("div",{className:"mt-4 text-center py-3 bg-gray-200 rounded text-gray-600 font-medium",children:"Assignment Closed"})]}):o?e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-300 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:"‚è∞"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-orange-700",children:"Not Submitted"}),e.jsx("p",{className:"text-sm text-orange-600",children:"Past due date"})]})]}),e.jsx("div",{className:"mt-4 text-center py-3 bg-orange-100 rounded text-orange-700 font-medium",children:"Late Submission Available"})]}):e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:"üìù"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700",children:"Not Submitted"}),e.jsx("p",{className:"text-sm text-blue-600",children:"Ready to submit"})]})]}),e.jsx("div",{className:"mt-4 text-center py-3 bg-blue-100 rounded text-blue-700 font-medium",children:"Submission Pending"})]});if(t.status!=="graded")return e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-700",children:"Submitted"}),e.jsx("p",{className:"text-sm text-yellow-600",children:"Waiting for grade"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Submitted:"}),e.jsx("span",{className:"font-medium",children:new Date(t.submitted_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})})]}),t.is_late&&e.jsx("div",{className:"bg-orange-100 text-orange-700 px-3 py-2 rounded text-center",children:"‚ö†Ô∏è Late Submission"}),e.jsx("div",{className:"text-center py-3 bg-yellow-100 rounded text-yellow-700 font-medium",children:"Grading in Progress"})]})]});const c=t.points_earned||t.grade||0,r=c/i*100;let a="gray",m="üìä",l="Graded";return r>=90?(a="green",m="üåü",l="Excellent"):r>=80?(a="blue",m="‚ú®",l="Great"):r>=70?(a="yellow",m="üëç",l="Good"):r>=60?(a="orange",m="üìà",l="Pass"):(a="red",m="üìâ",l="Needs Improvement"),e.jsxs("div",{className:`bg-${a}-50 border-2 border-${a}-300 rounded-lg p-6`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-4xl",children:m}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-bold text-${a}-700`,children:"Graded"}),e.jsx("p",{className:`text-sm text-${a}-600`,children:l})]})]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:`text-6xl font-bold text-${a}-700 mb-1`,children:c}),e.jsxs("div",{className:"text-gray-600 text-lg",children:["out of ",i," points"]}),e.jsxs("div",{className:`text-2xl font-semibold text-${a}-600 mt-2`,children:[r.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:e.jsx("div",{className:`bg-${a}-500 h-3 rounded-full transition-all duration-500`,style:{width:`${r}%`}})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Graded:"}),e.jsx("span",{className:"font-medium",children:t.graded_at&&new Date(t.graded_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),t.is_late&&t.grade!==t.points_earned&&e.jsx("div",{className:"bg-orange-100 text-orange-700 px-3 py-2 rounded text-center",children:"‚ö†Ô∏è Late penalty applied"}),t.feedback&&e.jsxs("div",{className:`bg-${a}-100 border border-${a}-200 rounded p-3 mt-3`,children:[e.jsxs("h4",{className:"font-semibold text-sm mb-1 flex items-center gap-2",children:[e.jsx("span",{children:"üí¨"})," Teacher Feedback"]}),e.jsx("p",{className:`text-sm text-${a}-800 whitespace-pre-wrap`,children:t.feedback})]})]})]})}function H({assignmentId:t,allowedTypes:i,maxSizeMB:o,onSuccess:n,onCancel:c}){const[r,a]=u.useState(null),[m,l]=u.useState(!1),[x,f]=u.useState(!1),[h,y]=u.useState(0),[S,p]=u.useState(""),g=u.useRef(null),N=d=>{d.preventDefault(),l(!0)},v=d=>{d.preventDefault(),l(!1)},j=d=>{d.preventDefault(),l(!1),p("");const b=d.dataTransfer.files[0];b&&_(b)},w=d=>{p("");const b=d.target.files?.[0];b&&_(b)},_=d=>{const b=A(d,{maxSizeMB:o,allowedTypes:i});if(!b.valid){p(b.error||"Invalid file"),a(null);return}a(d)},$=async()=>{if(r){f(!0),p(""),y(0);try{const d=window.supabase,{data:{session:b}}=await d.auth.getSession();if(!b)throw new Error("You must be logged in");const C=new FormData;C.append("file",r);const M=setInterval(()=>{y(B=>B>=90?(clearInterval(M),90):B+10)},200),k=await fetch(`/api/assignments/${t}/submit`,{method:"POST",headers:{Authorization:`Bearer ${b.access_token}`},body:C});clearInterval(M),y(100);const F=await k.json();if(!k.ok)throw new Error(F.error||"Upload failed");setTimeout(()=>{n()},500)}catch(d){p(d.message),y(0)}finally{f(!1)}}},D=()=>{a(null),p(""),g.current&&(g.current.value="")};return e.jsxs("div",{className:"space-y-4",children:[r?e.jsx("div",{className:"border border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"text-4xl flex-shrink-0",children:T(r.name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:U(r.size)}),x&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Uploading... ",h,"%"]})]})]})]}),!x&&e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-red-600 transition-colors",title:"Remove file",children:e.jsx("span",{className:"text-2xl",children:"√ó"})})]})}):e.jsxs("div",{onDragOver:N,onDragLeave:v,onDrop:j,onClick:()=>g.current?.click(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${m?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-5xl",children:"üìé"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Allowed types: ",i.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Maximum size: ",o,"MB"]})]})]}),e.jsx("input",{ref:g,type:"file",onChange:w,accept:i.map(d=>`.${d}`).join(","),className:"hidden"})]}),S&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:S}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:c,disabled:x,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:!r||x,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Uploading...":"Submit Assignment"})]})]})}const E=R("https://auyysgeurtnpidppebqj.supabase.co","***REMOVED***"),L=window.location.pathname.split("/")[2];let s=null;async function O(){try{const{data:{session:t}}=await E.auth.getSession();if(!t){window.location.href=`/login?redirect=/assignments/${L}`;return}const{data:i,error:o}=await E.from("assignments").select(`
            *,
            lessons(
              id, name,
              modules(
                id, name,
                courses(id, name, created_by)
              )
            )
          `).eq("id",L).eq("is_published",!0).single();if(o||!i)throw new Error("Assignment not found or access denied");const{data:n}=await E.from("assignment_submissions").select("*").eq("assignment_id",L).eq("user_id",t.user.id).order("submission_number",{ascending:!1}).limit(1).single();s={...i,user_submission:n||null},J(),Z()}catch(t){console.error("Error loading assignment:",t),V(t instanceof Error?t.message:"Failed to load assignment")}}function J(){if(!s)return;const t=s.lessons,i=t?.modules?.courses,o=document.getElementById("assignment-title");o&&(o.textContent=s.title);const n=document.getElementById("assignment-meta");n&&(n.textContent=`${i?.name||"Unknown Course"} ‚Ä¢ ${t?.name||"Unknown Lesson"}`);const c=document.getElementById("assignment-description");c&&s.description&&(c.textContent=s.description),q();const r=document.getElementById("assignment-instructions");if(r&&s.instructions&&(r.innerHTML=s.instructions.split(`
`).map(l=>`<p>${l}</p>`).join("")),s.grading_rubric){const l=document.getElementById("rubric-container");l&&I.createRoot(l).render(u.createElement(P,{rubric:s.grading_rubric,maxPoints:s.max_points}))}if(s.due_date){const l=document.getElementById("countdown-container");l&&I.createRoot(l).render(u.createElement(z,{dueDate:s.due_date,lateAllowed:s.allow_late_submissions}))}const a=document.getElementById("submission-status-container");if(a){const l=new Date,x=s.due_date?new Date(s.due_date):null,f=x?l>x:!1;I.createRoot(a).render(u.createElement(G,{submission:s.user_submission,maxPoints:s.max_points,isPastDue:f,lateAllowed:s.allow_late_submissions}))}Y(),X();const m=document.getElementById("content");m&&m.classList.remove("hidden")}function q(){if(!s)return;const t=document.getElementById("status-badge");if(!t)return;const i=new Date,o=s.due_date?new Date(s.due_date):null,n=o&&i>o,c=s.user_submission!==null;let r="";c?s.user_submission?.status==="graded"?r=`<span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-full">Graded: ${s.user_submission.points_earned||s.user_submission.grade||0}/${s.max_points}</span>`:r='<span class="px-4 py-2 bg-yellow-100 text-yellow-700 text-sm font-medium rounded-full">Submitted</span>':n&&!s.allow_late_submissions?r='<span class="px-4 py-2 bg-red-100 text-red-700 text-sm font-medium rounded-full">Closed</span>':n?r='<span class="px-4 py-2 bg-orange-100 text-orange-700 text-sm font-medium rounded-full">Late</span>':r='<span class="px-4 py-2 bg-blue-100 text-blue-700 text-sm font-medium rounded-full">Not Submitted</span>',t.innerHTML=r}function Y(){if(!s)return;const t=new Date,i=s.due_date?new Date(s.due_date):null,o=i&&t>i,n=s.user_submission!==null,c=!o||s.allow_late_submissions,r=s.allow_resubmission&&n&&s.user_submission&&s.user_submission.submission_number<s.max_submissions,a=document.getElementById("submission-form-container");if(a){if(!c&&!n){a.innerHTML=`
          <div class="bg-gray-50 border border-gray-300 rounded-lg p-8 text-center">
            <div class="text-6xl mb-4">üîí</div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">Submissions Closed</h3>
            <p class="text-gray-600">This assignment is no longer accepting submissions.</p>
          </div>
        `;return}if(!n||r){if(I.createRoot(a).render(u.createElement("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[u.createElement("h2",{key:"title",className:"text-2xl font-bold mb-4"},n?`Resubmission #${(s.user_submission?.submission_number||0)+1}`:"Submit Your Work"),u.createElement(H,{key:"uploader",assignmentId:s.id,allowedTypes:s.allowed_file_types,maxSizeMB:s.max_file_size_mb,onSuccess:()=>{window.location.reload()},onCancel:()=>{}})])),o&&s.allow_late_submissions&&!n){const l=document.createElement("div");l.className="mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg text-sm text-orange-700",l.innerHTML=`<strong>‚ö†Ô∏è Late Submission:</strong> A ${s.late_penalty_percent}% penalty will be applied to your grade.`,a.appendChild(l)}}else n&&(a.innerHTML=`
          <div class="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
            <div class="text-5xl mb-3">‚úÖ</div>
            <h3 class="text-lg font-bold text-green-700 mb-2">Assignment Submitted</h3>
            <p class="text-green-600 text-sm">Your work has been submitted and is awaiting grading.</p>
          </div>
        `)}}function X(){if(!s)return;const t=document.getElementById("assignment-details");t&&(t.innerHTML=`
        <div class="flex justify-between py-2 border-b border-gray-200">
          <span class="text-gray-600">Maximum Points:</span>
          <span class="font-medium">${s.max_points}</span>
        </div>

        ${s.due_date?`
          <div class="flex justify-between py-2 border-b border-gray-200">
            <span class="text-gray-600">Due Date:</span>
            <span class="font-medium">${new Date(s.due_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}</span>
          </div>
        `:""}

        <div class="flex justify-between py-2 border-b border-gray-200">
          <span class="text-gray-600">File Types:</span>
          <span class="font-medium text-xs">${s.allowed_file_types.slice(0,3).join(", ")}${s.allowed_file_types.length>3?` +${s.allowed_file_types.length-3}`:""}</span>
        </div>

        <div class="flex justify-between py-2 border-b border-gray-200">
          <span class="text-gray-600">Max File Size:</span>
          <span class="font-medium">${s.max_file_size_mb}MB</span>
        </div>

        <div class="flex justify-between py-2 border-b border-gray-200">
          <span class="text-gray-600">Late Submissions:</span>
          <span class="font-medium">${s.allow_late_submissions?`Allowed (${s.late_penalty_percent}% penalty)`:"Not Allowed"}</span>
        </div>

        <div class="flex justify-between py-2 border-b border-gray-200">
          <span class="text-gray-600">Resubmissions:</span>
          <span class="font-medium">${s.allow_resubmission?`Allowed (max ${s.max_submissions})`:"Not Allowed"}</span>
        </div>

        <div class="flex justify-between py-2">
          <span class="text-gray-600">Created:</span>
          <span class="font-medium">${new Date(s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}</span>
        </div>
      `)}function V(t){const i=document.getElementById("error"),o=document.getElementById("loading");i&&(i.textContent=t,i.classList.remove("hidden")),o&&o.classList.add("hidden")}function Z(){const t=document.getElementById("loading");t&&t.classList.add("hidden")}O();
