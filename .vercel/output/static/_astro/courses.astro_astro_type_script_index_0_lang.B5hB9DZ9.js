import{c as E}from"../assets/index.CS-uK3Uq.js";import{b as h,a as r,d as m}from"../assets/notifications.BUGlD4Nh.js";import"../assets/_commonjsHelpers.D6-XlEtG.js";const v="https://auyysgeurtnpidppebqj.supabase.co",b="***REMOVED***",l=E(v,b);let w=[],c=new Set,i=null,f="all",p="all";async function I(){const{data:{user:t}}=await l.auth.getUser();if(i=t,!i){window.location.href="/login";return}const{data:a}=await l.from("applications").select("name").eq("user_id",i.id).single();if(a?.name){const s=a.name.split(" ")[0],n=document.getElementById("welcome-text");n&&(n.textContent=`Welcome back, ${s}!`)}await Promise.all([k(),y()]),d(),A(),C()}async function k(){const{data:t,error:a}=await l.from("courses").select("*").eq("is_published",!0).order("created_at",{ascending:!1});if(a){console.error("Error loading courses:",a);return}w=t||[]}async function y(){if(!i)return;const{data:t,error:a}=await l.from("enrollments").select("course_id").eq("user_id",i.id).eq("status","active");if(a){console.error("Error loading enrollments:",a);return}c=new Set(t?.map(s=>s.course_id)||[])}function d(){const t=document.getElementById("loading"),a=document.getElementById("courses-grid"),s=document.getElementById("empty-state");let n=w;if(f==="enrolled"?n=n.filter(e=>c.has(e.id)):f==="available"&&(n=n.filter(e=>!c.has(e.id))),p!=="all"&&(n=n.filter(e=>e.track===p)),t?.classList.add("hidden"),n.length===0){a?.classList.add("hidden"),s?.classList.remove("hidden");return}s?.classList.add("hidden"),a?.classList.remove("hidden"),a.innerHTML=n.map(e=>{const o=c.has(e.id),u=e.thumbnail_url||"/images/course-placeholder.jpg";return`
        <div class="course-card-wrapper" data-course-id="${e.id}" data-slug="${e.slug}">
          <img src="${u}" alt="${e.title}" class="course-thumbnail" />
          <div class="course-content">
            <h3 class="course-title">${e.title}</h3>
            ${e.description?`<p class="course-description">${e.description}</p>`:""}
            <div class="course-meta">
              <span class="meta-tag">${S(e.track)}</span>
              <span class="meta-tag">${$(e.difficulty)}</span>
              ${e.default_duration_weeks?`<span class="meta-tag">${e.default_duration_weeks} weeks</span>`:""}
            </div>
            ${o?'<div class="enrolled-badge">✓ Enrolled</div>':'<button class="btn btn-primary btn-sm mt-3 w-full enroll-btn" data-course-id="'+e.id+'" onclick="event.stopPropagation()">Enroll Now</button>'}
            <div class="view-details-link">
              <span>View Course Details</span>
              <span class="view-details-arrow">→</span>
            </div>
          </div>
        </div>
      `}).join(""),document.querySelectorAll(".course-card-wrapper").forEach(e=>{e.addEventListener("click",()=>{const o=e.getAttribute("data-slug");o&&(window.location.href=`/courses/${o}`)})}),document.querySelectorAll(".enroll-btn").forEach(e=>{e.addEventListener("click",async o=>{o.stopPropagation();const u=parseInt(e.getAttribute("data-course-id")),g=e;h(g,!0,"Enrolling..."),await L(u),h(g,!1,"Enroll Now")})})}async function L(t){if(!i){r("Please login to enroll in courses","error"),setTimeout(()=>{window.location.href="/login"},1500);return}const a=r("Enrolling in course...","info",0);try{const{data:{session:s}}=await l.auth.getSession();if(!s){m(a),r("Session expired. Please login again.","error"),setTimeout(()=>{window.location.href="/login"},1500);return}const n=await fetch("/api/enroll",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({courseId:t})}),e=await n.json();if(m(a),!n.ok){n.status===409?r("You are already enrolled in this course!","warning"):r("Error enrolling: "+(e.error||"Unknown error"),"error");return}r("Successfully enrolled!","success"),await y(),d()}catch(s){console.error("Enrollment error:",s),m(a),r("Error enrolling in course. Please try again.","error")}}function A(){document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),t.classList.add("active"),f=t.getAttribute("data-filter")||"all",d()})}),document.querySelectorAll(".filter-chip").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".filter-chip").forEach(a=>a.classList.remove("active")),t.classList.add("active"),p=t.getAttribute("data-track")||"all",d()})})}function S(t){return{"animal-advocacy":"Animal Advocacy",climate:"Climate","ai-safety":"AI Safety",general:"General"}[t]||t}function $(t){return t.charAt(0).toUpperCase()+t.slice(1)}function C(){document.getElementById("logout-btn")?.addEventListener("click",async()=>{await l.auth.signOut(),window.location.href="/login"})}I();
