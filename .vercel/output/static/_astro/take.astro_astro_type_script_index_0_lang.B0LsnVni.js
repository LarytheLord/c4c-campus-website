const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/QuizTimer.DtGoIBdx.js","assets/jsx-runtime.D_zvdyIk.js","assets/index.GIa-TyKg.js","assets/_commonjsHelpers.D6-XlEtG.js","assets/index.CMF_dOlt.js","assets/client.alY4YNBQ.js","assets/index.Bkf-Ke-4.js","assets/QuizProgress.BtPHGX5P.js","assets/QuizQuestion.CxXpQBI9.js"])))=>i.map(i=>d[i]);
import{_ as p}from"../assets/preload-helper.BlTxHScW.js";import{c as q}from"../assets/index.CS-uK3Uq.js";import{a as l}from"../assets/notifications.BUGlD4Nh.js";import"../assets/_commonjsHelpers.D6-XlEtG.js";const B="https://auyysgeurtnpidppebqj.supabase.co",b="***REMOVED***",f=q(B,b);let o=null,r=null,c=[],m=new Map,d=0,w=!1,g=!1;window.addEventListener("beforeunload",t=>{if(g&&w)return t.preventDefault(),t.returnValue="",""});async function v(){const t=window.location.pathname.split("/"),e=parseInt(t[2]),i=new URLSearchParams(window.location.search).get("attemptId");if(isNaN(e)){l("Invalid quiz ID","error");return}const{data:{session:s}}=await f.auth.getSession();if(!s){window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname);return}try{i?await A(e,parseInt(i),s.access_token):await L(e,s.access_token),T()}catch(a){console.error("Error loading quiz:",a),l("Failed to load quiz","error")}}async function L(t,e){const n=await fetch(`/api/quizzes/${t}/start`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!n.ok){const u=await n.json();throw new Error(u.error||"Failed to start quiz")}const i=await n.json();o=(await(await fetch(`/api/quizzes/${t}`,{headers:{Authorization:`Bearer ${e}`}})).json()).quiz,r=i.attempt,c=i.questions,document.getElementById("loading-state")?.classList.add("hidden")}async function A(t,e,n){const[i,s]=await Promise.all([fetch(`/api/quizzes/${t}`,{headers:{Authorization:`Bearer ${n}`}}),fetch(`/api/quizzes/${t}/attempts/${e}`,{headers:{Authorization:`Bearer ${n}`}})]),a=await i.json(),u=await s.json();o=a.quiz,r=u.attempt,c=u.questions,r.answers_json&&Array.isArray(r.answers_json)&&r.answers_json.forEach(h=>{m.set(h.question_id,h.answer)}),document.getElementById("loading-state")?.classList.add("hidden")}function T(){if(!o)return;document.getElementById("quiz-title").textContent=o.title,document.getElementById("quiz-info").textContent=`Attempt #${r.attemptNumber}`;const t=document.getElementById("instructions-modal"),e=document.getElementById("instructions-content");e.innerHTML=o.instructions||"<p>Read each question carefully and select your answer.</p>",document.getElementById("passing-score-text").textContent=`Passing score: ${o.passing_score}%`,document.getElementById("questions-count-text").textContent=`${c.length} questions`,o.time_limit?document.getElementById("time-limit-text").textContent=`Time limit: ${o.time_limit} minutes`:document.getElementById("time-limit-info")?.classList.add("hidden"),t.classList.remove("hidden"),document.getElementById("start-quiz-btn").onclick=D,document.getElementById("cancel-btn").onclick=n=>{n.preventDefault(),history.back()}}function D(){document.getElementById("instructions-modal")?.classList.add("hidden"),document.getElementById("quiz-content")?.classList.remove("hidden"),w=!0,g=!0,o?.time_limit&&$(),I(),y()}function $(){if(!o||!r)return;const t=document.getElementById("timer-container");t.classList.remove("hidden"),p(async()=>{const{QuizTimer:e}=await import("../assets/QuizTimer.DtGoIBdx.js");return{QuizTimer:e}},__vite__mapDeps([0,1,2,3,4])).then(({QuizTimer:e})=>{p(async()=>{const{createRoot:n}=await import("../assets/client.alY4YNBQ.js").then(i=>i.c);return{createRoot:n}},__vite__mapDeps([5,4,6])).then(({createRoot:n})=>{n(t).render(e({startedAt:r.startedAt,timeLimit:o.time_limit,onTimeUp:C}))})})}function C(){l("Time is up! Submitting your quiz...","warning"),setTimeout(()=>{z()},2e3)}function I(){const t=c[d];if(!t)return;const e=document.getElementById("question-container"),n=document.getElementById("progress-container");p(async()=>{const{QuizProgress:i}=await import("../assets/QuizProgress.BtPHGX5P.js");return{QuizProgress:i}},__vite__mapDeps([7,1,2,3,4])).then(({QuizProgress:i})=>{p(async()=>{const{createRoot:s}=await import("../assets/client.alY4YNBQ.js").then(a=>a.c);return{createRoot:s}},__vite__mapDeps([5,4,6])).then(({createRoot:s})=>{const a=s(n),u=new Set(Array.from(m.keys()).map(h=>c.findIndex(_=>_.id===h)+1));a.render(i({currentQuestion:d+1,totalQuestions:c.length,answeredQuestions:u,showAll:!0}))})}),p(async()=>{const{QuizQuestion:i}=await import("../assets/QuizQuestion.CxXpQBI9.js");return{QuizQuestion:i}},__vite__mapDeps([8,1,2,3,4])).then(({QuizQuestion:i})=>{p(async()=>{const{createRoot:s}=await import("../assets/client.alY4YNBQ.js").then(a=>a.c);return{createRoot:s}},__vite__mapDeps([5,4,6])).then(({createRoot:s})=>{s(e).render(i({question:t,questionNumber:d+1,totalQuestions:c.length,value:m.get(t.id)||"",onChange:u=>{m.set(t.id,u),y()}}))})})}function y(){const t=document.getElementById("prev-question-btn"),e=document.getElementById("next-question-btn"),n=document.getElementById("submit-quiz-btn");t.disabled=d===0,d===c.length-1?(e.classList.add("hidden"),n.classList.remove("hidden")):(e.classList.remove("hidden"),n.classList.add("hidden"))}async function E(){if(!(!o||!r))try{const{data:{session:t}}=await f.auth.getSession();if(!t)return;const e=Array.from(m.entries()).map(([n,i])=>({questionId:n,answer:i}));await fetch(`/api/quizzes/${o.id}/attempts/${r.id}/save`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({answers:e})}),l("Draft saved","success")}catch(t){console.error("Error saving draft:",t),l("Failed to save draft","error")}}async function z(){if(!(!o||!r))try{const{data:{session:t}}=await f.auth.getSession();if(!t)return;const e=Array.from(m.entries()).map(([s,a])=>({questionId:s,answer:a})),n=await fetch(`/api/quizzes/${o.id}/attempts/${r.id}/submit`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({answers:e})});if(!n.ok)throw new Error("Failed to submit quiz");const i=await n.json();g=!1,l("Quiz submitted successfully!","success"),setTimeout(()=>{window.location.href=`/quizzes/${o.id}/results/${r.id}`},1e3)}catch(t){console.error("Error submitting quiz:",t),l("Failed to submit quiz","error")}}function x(){const t=document.getElementById("submit-modal");document.getElementById("answered-count").textContent=m.size.toString(),document.getElementById("total-count").textContent=c.length.toString(),t.classList.remove("hidden")}document.getElementById("prev-question-btn")?.addEventListener("click",()=>{d>0&&(d--,I(),y())});document.getElementById("next-question-btn")?.addEventListener("click",()=>{d<c.length-1&&(d++,I(),y())});document.getElementById("save-draft-btn")?.addEventListener("click",E);document.getElementById("submit-quiz-btn")?.addEventListener("click",x);document.getElementById("confirm-submit-btn")?.addEventListener("click",()=>{document.getElementById("submit-modal")?.classList.add("hidden"),z()});document.getElementById("cancel-submit-btn")?.addEventListener("click",()=>{document.getElementById("submit-modal")?.classList.add("hidden")});setInterval(E,3e4);v();
